setwd('../Tutorials')
dyn.load(paste("exampleRListArg", .Platform$dynlib.ext, sep=''))
v1 <- list(a=rnorm(3), b=rnorm(5))
v2 <- rnorm(3)
.Call("anyfun", v1, v2)
v1
v2
mydata<-read.table("~/Dropbox/Brekfis/dynr/data/dataPANAsim.txt")
head(mydata)
dataframe=mydata
unique(dataframe[,id])
id='V1', time="V2",observed=paste0('V', 3:4), covariates=paste0('V', 5)
id='V1'
time="V2"
observed=paste0('V', 3:4)
covariates=paste0('V', 5)
unique(dataframe[,id])
which(dataframe[,id]%in%unique(dataframe[,id]))
which(min(dataframe[,id]%in%unique(dataframe[,id])))
min(which(dataframe[,id]%in%unique(dataframe[,id])))
ids=unique(dataframe[,id])
tstart=sapply(1:length(ids),function(i){min(which(dataframe[,id]%in%ids[i]))})
tstart
dim(dataframe)[2]
dim(dataframe)[1]
c(sapply(1:length(ids),function(i){min(which(dataframe[,id]%in%ids[i]))})-1,dim(dataframe)[1])
dynr.data<-function(dataframe,id,time,observed,covariates){
ids=unique(dataframe[,id])
tstart=c(sapply(1:length(ids),function(i){min(which(dataframe[,id]%in%ids[i]))})-1,dim(dataframe)[1])
data.object<-list(tstart=tstart,time=time,observed=dataframe[,observed],covariates=dataframe[,covariates])
}
dynr.data(mydata, id='V1', time="V2",observed=paste0('V', 3:4), covariates=paste0('V', 5))
dynr.data<-function(dataframe,id,time,observed,covariates){
ids=unique(dataframe[,id])
tstart=c(sapply(1:length(ids),function(i){min(which(dataframe[,id]%in%ids[i]))})-1,dim(dataframe)[1])
data.object<-list(tstart=tstart,time=time,observed=dataframe[,observed],covariates=dataframe[,covariates])
return(data.object)
}
dynr.data(mydata, id='V1', time="V2",observed=paste0('V', 3:4), covariates=paste0('V', 5))
data<-dynr.data(mydata, id='V1', time="V2",observed=paste0('V', 3:4), covariates=paste0('V', 5))
names(data)
data$tstart
dim(data$observed)
is.data.frame(data$observed)
names(data$observed)
unlist(dataframe[,observed])
mode(unlist(dataframe[,observed]))
head(unlist(dataframe[,observed]))
head(dataframe[,observed])
names(data$observed)
paste0('V', 3:4)
observed=as.matrix(dataframe[,observed])
mode(observed)
observed=as.list(as.matrix(dataframe[,observed]))
covariates=data.frame(dataframe[,covariates])
names(covariates)
dim(covariates)
observed=data.frame(dataframe[,observed])
observed=paste0('V', 3:4)
observed=data.frame(dataframe[,observed])
dim(observed)
names(observed)
dynr.data<-function(dataframe,id,time,observed,covariates){
ids=unique(dataframe[,id])
tstart=c(sapply(1:length(ids),function(i){min(which(dataframe[,id]%in%ids[i]))})-1,dim(dataframe)[1])
data.object<-list(tstart=tstart,time=time,observed=data.frame(dataframe[,observed]),covariates=data.frame(dataframe[,covariates]))
names(data.object$observed)<-paste0("obs",1:length(observed))
names(data.object$covariates)<-paste0("covar",1:length(covariates))
return(data.object)
}
mydata<-read.table("~/Dropbox/Brekfis/dynr/data/dataPANAsim.txt")
data<-dynr.data(mydata, id="V1", time="V2",observed=paste0('V', 3:4), covariates=paste0('V', 5))
head(data$observed$obs1)
head(data$covariates$covar1)
mode(data$covariates$covar1)
mode(data$covariates)
mode(data)
data$time
dynr.data<-function(dataframe,id,time,observed,covariates){
ids=unique(dataframe[,id])
tstart=c(sapply(1:length(ids),function(i){min(which(dataframe[,id]%in%ids[i]))})-1,dim(dataframe)[1])
data.object<-list(tstart=tstart,time=data.frame(dataframe[,time]),observed=data.frame(dataframe[,observed]),covariates=data.frame(dataframe[,covariates]))
names(data.object$observed)<-paste0("obs",1:length(observed))
names(data.object$covariates)<-paste0("covar",1:length(covariates))
return(data.object)
}
mydata<-read.table("~/Dropbox/Brekfis/dynr/data/dataPANAsim.txt")
data<-dynr.data(mydata, id="V1", time="V2",observed=paste0('V', 3:4), covariates=paste0('V', 5))
data$time
dyn.load(file.path("~/Dropbox/Brekfis/dynr/src",paste("wrappernegloglike",.Platform$dynlib.ext,sep="")))
dyn.load(file.path("~/Dropbox/Brekfis/dynr/src",paste("wrappernegloglike",.Platform$dynlib.ext,sep="")))
dyn.load(file.path("~/Dropbox/Brekfis/dynr/src",paste("PANAmodel",.Platform$dynlib.ext,sep="")))
dynr.run<- function(model,data) {
tmp=.Call('main_R',model,data, PACKAGE='dynr')
return(tmp)
}
dynr.data<-function(dataframe,id,time,observed,covariates){
ids=unique(dataframe[,id])
tstart=c(sapply(1:length(ids),function(i){min(which(dataframe[,id]%in%ids[i]))})-1,dim(dataframe)[1])
data.object<-list(tstart=tstart,time=dataframe[,time],observed=data.frame(dataframe[,observed]),covariates=data.frame(dataframe[,covariates]))
names(data.object$observed)<-paste0("obs",1:length(observed))
names(data.object$covariates)<-paste0("covar",1:length(covariates))
return(data.object)
}
mydata<-read.table("~/Dropbox/Brekfis/dynr/data/dataPANAsim.txt")#Missing data NA
data<-dynr.data(mydata, id="V1", time="V2",observed=paste0('V', 3:4), covariates=paste0('V', 5))
model<-list(num_sbj=217,
dim_latent_var=4,
dim_obs_var=2,
dim_co_variate=1,
num_regime=1,
xstart=c(log(1),log(2),0,0,-10,-10),
num_func_param=6,
ub=c(5, 5, 5, 5, 5, 5),
lb=c(-5,-5,-5,-5,-15, -15)
)
starttime=proc.time()
x<-dynr.run(model,data)
(time=proc.time()-starttime)
dynr.run<- function(model,data) {
#tmp=.Call('main_R',model,data, PACKAGE='dynr')
tmp=.Call('main_R',model,data)
return(tmp)
}
dynr.data<-function(dataframe,id,time,observed,covariates){
ids=unique(dataframe[,id])
tstart=c(sapply(1:length(ids),function(i){min(which(dataframe[,id]%in%ids[i]))})-1,dim(dataframe)[1])
data.object<-list(tstart=tstart,time=dataframe[,time],observed=data.frame(dataframe[,observed]),covariates=data.frame(dataframe[,covariates]))
names(data.object$observed)<-paste0("obs",1:length(observed))
names(data.object$covariates)<-paste0("covar",1:length(covariates))
return(data.object)
}
model<-list(num_sbj=217,
dim_latent_var=4,
dim_obs_var=2,
dim_co_variate=1,
num_regime=1,
xstart=c(log(1),log(2),0,0,-10,-10),
num_func_param=6,
ub=c(5, 5, 5, 5, 5, 5),
lb=c(-5,-5,-5,-5,-15, -15)
)
# initial values and bounds
starttime=proc.time()
x<-dynr.run(model,data)
(time=proc.time()-starttime)
x
dyn.load(file.path("~/Dropbox/Brekfis/dynr/src",paste("PANAmodel",.Platform$dynlib.ext,sep="")))
dyn.load(file.path("~/Dropbox/Brekfis/dynr/src",paste("PANAmodel",.Platform$dynlib.ext,sep="")))
dynr.run<- function(model,data) {
tmp <- .Call("main_R", model, data, PACKAGE = "dynr")
#tmp=.Call('main_R',model,data)
return(tmp)
}
dynr.data<-function(dataframe,id,time,observed,covariates){
ids=unique(dataframe[,id])
tstart=c(sapply(1:length(ids),function(i){min(which(dataframe[,id]%in%ids[i]))})-1,dim(dataframe)[1])
data.object<-list(tstart=tstart,time=dataframe[,time],observed=data.frame(dataframe[,observed]),covariates=data.frame(dataframe[,covariates]))
names(data.object$observed)<-paste0("obs",1:length(observed))
names(data.object$covariates)<-paste0("covar",1:length(covariates))
return(data.object)
}
mydata<-read.table("~/Dropbox/Brekfis/dynr/data/dataPANAsim.txt")#Missing data NA
data<-dynr.data(mydata, id="V1", time="V2",observed=paste0('V', 3:4), covariates=paste0('V', 5))
model<-list(num_sbj=217,
dim_latent_var=4,
dim_obs_var=2,
dim_co_variate=1,
num_regime=1,
xstart=c(log(1),log(2),0,0,-10,-10),
num_func_param=6,
ub=c(5, 5, 5, 5, 5, 5),
lb=c(-5,-5,-5,-5,-15, -15)
)
starttime=proc.time()
x<-dynr.run(model,data)
dynr.run<- function(model,data) {
#tmp <- .Call("main_R", model, data, PACKAGE = "dynr")
tmp=.Call('main_R',model,data)
return(tmp)
}
x<-dynr.run(model,data)
x
require(dynr)
data(dataPANAsim)
data <- dynr.data(dataPANAsim, id="V1", time="V2",observed=paste0('V', 3:4), covariates=paste0('V', 5))
# the model
model <- list(num_sbj=217,
dim_latent_var=4,
dim_obs_var=2,
dim_co_variate=1,
num_regime=1,
xstart=c(log(1),log(2),0,0,-10,-10),
num_func_param=6,
ub=c(5, 5, 5, 5, 5, 5),
lb=c(-5,-5,-5,-5,-15, -15)
)
starttime <- proc.time()
x<-dynr.run(model, data)
names(x)
dim(x$eta_smooth_final)
x$eta_smooth_final[1,1]
x$eta_smooth_final[:,1]
x$eta_smooth_final[,1]
